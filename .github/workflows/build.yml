name: Build macOS App (uniCenta / Chromis)

on:
  workflow_dispatch:

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Install Java & Maven
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '11'   # uniCenta/Chromis ÙŠØ­ØªØ§Ø¬ Java 11

    - name: BUILD (Maven)
      run: |
        mvn -e -X -B clean package
        echo "âœ… Maven build done"

    - name: Debug target folder
      run: |
        echo "ðŸ“‚ Listing target folder"
        ls -al target || echo "âš ï¸ target folder not found!"

    - name: Find jar file
      id: findjar
      run: |
        jarfile=$(find target -name "*.jar" | head -n 1)
        if [ -z "$jarfile" ]; then
          echo "âŒ No JAR produced!"
          exit 1
        fi
        echo "jar=$jarfile" >> $GITHUB_OUTPUT
        echo "âœ… Found jar â†’ $jarfile"

    - name: Create macOS .app bundle
      run: |
        mkdir -p build/unicentaPOS.app/Contents/MacOS
        cp "${{ steps.findjar.outputs.jar }}" build/unicentaPOS.app/Contents/MacOS/
        echo "âœ… Copied jar to app bundle"

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: unicenta-macos
        path: build/unicentaPOS.app
